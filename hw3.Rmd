---
output: pdf_document
---

Alyssa Vanderbeek (amv2187)  
12 October 2018  
HW 3  

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)

library(tidyverse)
```

### Problem 2: Cigarette smoking continues to be a public health problem with major consequences on heart and lung diseases. Less is actually known about the consequences of quitting smoking. A recent study selected a group of 10 women working at a small medical practice, ages 50-64, that had smoked at least 1 pack/day and quit for at least 6 years (data “HeavySmoke.csv”).

### 1. The first question is to assess if their body mass index (BMI) has changed 6 years after quitting smoking. Perform an appropriate hypothesis test and interpret your findings.

Because we are looking at the difference in outcomes over time within the same individuals, we perform a paired t test with hypotheses
$H_0: \Delta = \mu_{\text{6yrs}} - \mu_{\text{baseline}} = 0$ vs.
$H_1: \Delta \neq 0$
In plain english, we are testing whether there is ($H_1$) or is not ($H_0$) a difference in BMI in women who quit smoking 6 years prior.

We know sample size $n = 10$, and the test statistic is given by  
$t = \frac{\bar{\Delta} - 0}{s/\sqrt{n}}$, where $\bar{\Delta} = \frac{\sum_{i=1}^n {\Delta_i}}{n}$ and $s = \sqrt{\frac{\sum_{i=1}^n{(\Delta_i - \bar{\Delta)^2}}}{n - 1}}$.

```{r}
heavy_smoke = read_csv('~/Desktop/FALL 2018/Biostat I/Homework/data/HW3_export/HeavySmoke.csv', col_types = cols()) %>%
  janitor::clean_names() %>%
  mutate(diff = bmi_6yrs - bmi_base)

n1 = nrow(heavy_smoke) # sample size
dbar = sum(heavy_smoke$diff) / n1 # mean change in BMI
dif_sq = sum((heavy_smoke$diff - dbar)^2) # sum of squares
s1 = sqrt(dif_sq / (n1 - 1)) # sample sd

t_heavy = dbar / (s1/sqrt(n1)) # test statistic
rej1 = qt(p = 0.975, df = n1 - 1)
```

Given our data, we find that $\bar{\Delta} =$ `r dbar`, $s =$ `r round(s1, 2)` $t = \frac{3.36}{2.46/\sqrt{10}} =$ `r round(t_heavy, 2)`.

At a 5% significance level, we reject the null hypothesis that there is no change in BMI if the test statistic $t > t_{1-\alpha/2, n-1}$, where $t_{1-\alpha/2, n-1} = t_{0.975, 9} =$ `r rej1`. And since 4.31 > 2.26, we reject the null in favor of the hypothesis and conclude that women who quit smoking after years of heavy consumption may expect a change in BMI in the following years. 



### 2. The investigators suspected an overall change in weight over the years, so they decided to enroll a control group of 50-64 years of age that never smoked (data NeverSmoke.csv). Perform an appropriate test to compare the BMI changes between women that quit smoking and women who never smoked. Interpret the findings.

$H_0: \Delta_{\text{smokers}} - \Delta_{\text{not smokers}} = 0$ vs.
$H_1: \Delta_{\text{smokers}} - \Delta_{\text{not smokers}} \neq 0$


```{r}
never_smoke = read_csv('~/Desktop/FALL 2018/Biostat I/Homework/data/HW3_export/NeverSmoke.csv', col_types = cols()) %>%
  janitor::clean_names() %>%
  mutate(diff = bmi_6yrs - bmi_base)

# first test for equality of variance
n2 = nrow(never_smoke) # sample size
dbar2 = sum(never_smoke$diff) / n2
dif_sq2 = sum((never_smoke$diff - dbar2)^2) # sum of squares
s2 = sqrt(dif_sq2 / (n2 - 1)) # sample sd

f = s1^2 / s2^2
f.rej = qf(p = 0.975, df1 = n1 - 1, df2 = n2 - 1)

# we conclude equal variances between groups
s_pooled = sqrt(((n1 - 1)*s1^2 + (n2 - 1)*s2^2) / (n1 + n2 - 2))

t_twosample = (dbar - dbar2) / (s_pooled*sqrt((1/n1) + (1/n2)))
rej2 = qt(p = 0.975, df = n1 + n2 - 2)

# check hand calculations with built-in function
# t.test(heavy_smoke$diff, never_smoke$diff, alternative = 'two.sided', var.equal = T)
```

### 3. Show the corresponding 95% CI associated with part 2. Interpret it in the context of the problem.

```{r}
CI = c(
  (dbar - dbar2) - rej2*(s_pooled*sqrt((1/n1) + (1/n2))),
  (dbar - dbar2) + rej2*(s_pooled*sqrt((1/n1) + (1/n2)))
)
```

### 4. Suppose the researchers want to launch into a larger study to prove that a difference does exist between the two groups with respect to BMI changes.

### (a) How would you design the new study? Comment on elements of study design such as randomization, possible causes of bias that should be avoided, etc.

### (b) Calculate the sample size for the new study. Assuming a two-sided test, create a table showing sample size estimates for 80% vs 90% power, 2.5% vs 5% significance level, using the following information: the true mean increase for smokers is 3.0 kg/m2, with a standard deviation of 2.0 kg/m2; for never-smokers the true mean increase is 1.7 kg/m2, with a standard deviation of 1.5 kg/m2.








### Problem 3: A rehabilitation center is interested in examining the relationship between physical status before therapy and the time (days) required in physical therapy until successful rehabilitation. Records from patients 18-30 years old were collected and provided to you for statistical analysis (data “Knee.csv”).

### 1. Generate descriptive statistics for each group and comment on the differences observed

```{r}
# import data
knee_data = read_csv('~/Desktop/FALL 2018/Biostat I/Homework/data/HW3_export/Knee.csv', col_types = cols()) 

# produce table of summary statistics 
apply(X = knee_data, FUN = summary, MARGIN = 2) %>% # apply the summary function to each column of the data
  do.call(bind_rows, .) %>% # take list produced by apply and turn into tibble
  mutate('Physical Health' = colnames(knee_data)) %>% # make a column specifying what group each row corresponds to
  select(`Physical Health`, everything()) %>% # rearrange column order
  knitr::kable(caption = 'Summary statistics across') # make nice-looking table

# boxplot of distribution of days across physical health groups
knee_data = knee_data %>%
  gather(key = 'physical_status', value = 'days') 

knee_data %>% # long format for easy plotting
  ggplot(aes(x = physical_status, y = days)) +
    geom_boxplot() +
    labs(title = 'Number of days in physical therapy',
         x = 'Physical health status',
         y = 'Days') 
```

### 2. Using a type I error of 0.01, obtain the ANOVA table. State the hypotheses, decision rule and conclusion.

$H_0$ = Physical status has no effect on the amount of physical therapy needed for rehabilitation. (Duration of physical therapy is the same in all physical status categories)

$H_1$ = Physical status has some effect on the amount of physical therapy needed for rehabilitation. (Duration of physical therapy is different in at least one physical status category)

With a sample size of 30 participants (10 per group) and $\alpha = 0.01$, we will reject the null hypothesis in favor of the alternative if the computed F statistic $F$ is greater than the critical value $F_{3-1,30-1,1-\alpha} = F_{2,29,0.99} =$ `r qf(0.99, 2, 29)`.

As seen in the below ANOVA table, our F-statistic for the test is greater than 19. Since 19 > `r qf(0.99, 2, 29)`, we reject the null in favor of the alternative that physical status affects the amount of physical therapy needed for rehabilitation.

```{r}
# ANOVA table
anova(lm(days~factor(physical_status), data = knee_data)) %>%
  knitr::kable()
```

### 3. Based on your response in part 3, perform pairwise comparisons with the appropriate adjustments (Bonferroni, Tukey, and Dunnett – ‘below average’ as reference). Report your findings and comment on the differences/similarities between these three methods.

```{r, echo=TRUE}
# multiple testing adjustments
pairwise.t.test(knee_data$days, knee_data$physical_status, p.adj = 'bonferroni')
TukeyHSD(aov(days~factor(physical_status), data = knee_data))
multcomp::glht(aov(days~factor(physical_status), data = knee_data),
               lincft = mcp(method = "Dunnett"))
```

### 4. Write a short paragraph summarizing your results as if you were presenting to the rehabilitation center director.

Using this data, we are interested in knowing whether someone's overall physical health status (e.g. below, at, or above average) impacts the amount of time needed in physical therapy in order to fully recover. Since we have three categories of physical fitness, we can use an ANOVA test to understand whether at least one of these groups has a significantly different distribution of physical therapy duration. According to this test, and at a 5% significant level, we conclude that in fact physical fitness does have an impact on the duration of physical therapy. Upon further examination, people in the 'above average' category spend a significantly less amount of time (number of days) in physical therapy, whereas there was no difference in the amount of time spent in physical therapy for those of average or below average health. Statisical results are provided above, as well as a figure depicting the distribution of physical therapy duration in each group. 
